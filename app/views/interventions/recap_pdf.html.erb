<!-- app/views/interventions/recap_pdf.html.erb -->
<div class="header">
  <div class="header-top">
    <img src="data:image/png;base64,<%= @logo_base64 %>" alt="KeepCalm" class="logo">
    <h1>Récapitulatif</h1>
  </div>
  <div class="header-card">
    <p>Récapitulatif de votre intervention à transmettre aux secours ou au médecin si besoin :</p>
  </div>
</div>

<div class="card-recap">

  <div class="text-recap justify-between">
    <div class="row-label">
      <p>Date de l'intervention</p>
    </div>
    <p class="value"><%= @intervention.start_time.present? ? @intervention.start_time.in_time_zone("Europe/Paris").strftime("%-d/%-m/%Y") : "-" %></p>
  </div>

  <div class="text-recap justify-between">
    <div class="row-label">
      <p>Déclenchement de l'aide</p>
    </div>
    <p class="value"><%= @chat&.created_at&.in_time_zone("Europe/Paris")&.strftime("%kh%M") || "-" %></p>
  </div>

  <div class="text-recap flex-column">
    <div class="row-label">
      <p>Situation</p>
    </div>
    <ul class="value">
        <li>D'après les informations recueillies, la personne a été victime d'un <strong><%= @case.name.downcase %></strong></li>
        <li>Durée du no-flow estimée:
          <% help_start_time = @chat.created_at %>
          <% rcp_start = @intervention.start_time.in_time_zone("Europe/Paris").strftime("%kh%M") %>
          <% rcp_start_time = @intervention.start_time %>
          <%# no-flow %>
          <% duration_no_flow = rcp_start_time - help_start_time %>
          <% minutes = (duration_no_flow / 60).to_i %>
          <% seconds = (duration_no_flow % 60).to_i %>
          <% rcp_duration_no_f = "#{minutes}min #{seconds}s" %>
          <strong><%= rcp_duration_no_f %></strong>
        </li>
        <li>Durée du low-flow estimée:
          <%# low-flow %>
          <% duration = @intervention.end_time - @intervention.start_time %>
          <% low_minutes = (duration / 60).to_i %>
          <% low_seconds = (duration % 60).to_i %>
          <% rcp_duration = "#{low_minutes}min #{low_seconds}s" %>
          <strong><%= rcp_duration %></strong></li>
      </ul>
  </div>

  <div class="text-recap flex-column">
    <div class="row-label">
      <p>Adresse</p>
    </div>
    <p class="value"><%= @intervention.address || "-" %></p>
  </div>

  <div class="text-recap justify-between">
    <div class="row-label-red">
      <p>Début de la RCP estimée</p>
    </div>
    <p class="value"><%= @intervention.start_time.present? ? @intervention.start_time.in_time_zone("Europe/Paris").strftime("%kh%M") : "-" %></p>
  </div>

  <div class="text-recap justify-between">
    <div class="row-label-red">
      <p>Durée de la RCP</p>
    </div>
    <p class="value">
      <% if @intervention.start_time && @intervention.end_time %>
        <% duration = @intervention.end_time - @intervention.start_time %>
        <% minutes = (duration / 60).to_i %>
        <% seconds = (duration % 60).to_i %>
        <%= "#{minutes}min #{seconds}s" %>
      <% else %>
        -
      <% end %>
    </p>
  </div>

  <div class="text-recap justify-between">
    <div class="row-label">
      <p>Heure de fin</p>
    </div>
    <p class="value"><%= @intervention.end_time.present? ? @intervention.end_time.in_time_zone("Europe/Paris").strftime("%kh%M") : "-" %></p>
  </div>

</div>

<div class="footer">
  <p>Généré par <strong>KeepCalm</strong></p>
  <p class="footer-small">Intervention #<%= @intervention.id %> • <%= Time.current.in_time_zone("Europe/Paris").strftime("%d/%m/%Y à %Hh%M") %></p>
</div>
